---
type: å·¥ç¨‹é…å¥—
title: ReactçŠ¶æ€ç®¡ç†
subtitle: sso
icon: ğŸ‘
order: 5
---

# SSO React å…±äº«çŠ¶æ€å¯¹è±¡

> Shared Store Object `å…±äº«çŠ¶æ€å¯¹è±¡`
> é€šè¿‡ useSyncExternalStore è¡”æ¥çš„å¤–éƒ¨çŠ¶æ€ç®¡ç†

## å®‰è£…ä¾èµ–

import { npmInstall, NpmTabs } from '@app/mdx-scope';

<NpmTabs
  npm={npmInstall('npm', { package: 'shared-store-object' })}
  yarn={npmInstall('yarn', { package: 'shared-store-object' })}
  pnpm={npmInstall('pnpm', { package: 'shared-store-object' })}
/>

## ä½¿ç”¨æ–¹å¼

> é¡µé¢ render ååœ¨ä»»æ„ä½ç½®ä½¿ç”¨, å¯é€šè¿‡ç®€å•çš„æ–¹å¼è¿›è¡Œåˆ›å»ºã€ä¿®æ”¹ã€å›æ”¶ï¼ˆå›æ”¶çš„å¯¹è±¡å°†æ— æ³•ç»§ç»­ä½¿ç”¨ï¼‰

```jsx
// å¼•å…¥ æˆ– import { sso } from '@moneko/react';
import sso from 'shared-store-object';

// åˆ›å»ºå…¬å…±çŠ¶æ€
const like = sso({
  count: 0,
  inc() {
    store.count++;
  },
});

// ä½¿ç”¨
const App = () => {
  const { count, inc } = like;

  return (
    <div>
      <p>{count}</p>
      <button onClick={inc}>inc</button>
      {/* ç›´æ¥ä¿®æ”¹ */}
      <button onClick={() => like.count++}>add</button>
      {/* å‡½æ•°å‡½æ•°ä¿®æ”¹ */}
      <button onClick={() => like('count', (prev) => prev + 1)}>func</button>
    </div>
  );
};

// ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ react å‡½æ•°å¤–æ“ä½œ
like.count++;
```

## è®¡ç®—å±æ€§

> åœ¨ç¬¬äºŒä¸ªå…¥å‚ä¸­é…ç½®è®¡ç®—å±æ€§

```jsx
// ä½¿ç”¨
const store = sso(
  {
    count: 0,
    inc() {
      store.count++;
    },
  },
  // åœ¨è¿™é‡Œé…ç½®è®¡ç®—å±æ€§
  {
    age() {
      return store.count * 2 + 1;
    },
  },
);

const App = () => {
  const { count, age } = store;

  return (
    <div>
      <p>count: {count}</p>
      <p>age: {age}</p>
      <button onClick={() => store.inc()}>add</button>
    </div>
  );
};
```

## å›æ”¶

> å½“ä½œ react çš„ useState æ¥ä½¿ç”¨ï¼Œå¹¶åœ¨ç»„ä»¶å¸è½½æ—¶æ‰‹åŠ¨å›æ”¶

```jsx
// ä½¿ç”¨
const App = () => {
  const store = useRef(sso({ count: 0 }));
  // ç»“æ„å‡º deps å¯¹è±¡
  const { count } = store.current;

  useEffect(() => {
    return () => {
      // å›æ”¶ä¹‹åå°†æ— æ³•ç»§ç»­ä½¿ç”¨store
      store.current();
    };
  }, []);
  return (
    <div>
      <p>{count}</p>
      <button onClick={() => store.count++}>add</button>
    </div>
  );
};
```

## é…ç½®é¡¹

> é€šè¿‡ `next` å‚æ•°ä¼ é€’çš„ `iteration` å‡½æ•°å†³å®šæ˜¯å¦éœ€è¦è¿›è¡Œè¿­ä»£

### å…¨å±€

> æ‰€æœ‰çš„ sso éƒ½å°†ä½¿ç”¨è¿™ä¸ªé…ç½®

```js
sso.config({
  next(iteration, key, data) {
    console.log('global', key, data);
    // ä¸æ‰§è¡Œ iteration å‡½æ•°æ•°æ®å°†ä¸ä¼šæ”¹å˜
    iteration();
  },
});
```

### ç§æœ‰

> ä¸ºå•ç‹¬çš„å¯¹è±¡è®¾ç½®ç§æœ‰çš„é…ç½®, æƒé™é«˜äºå…¨å±€é…ç½®

```ts
const app = sso({
  count: 0,
});

type AppShared = typeof app;

app(() => {
  return {
    next(iteration: VoidFunction, key: keyof AppShared, data: AppShared) {
      console.log('app', key, data);
      // ä¸æ‰§è¡Œ iteration å‡½æ•°æ•°æ®å°†ä¸ä¼šæ”¹å˜
      iteration();
    },
  };
});
// æˆ–è€…è¿™æ ·å†™
app((): Partial<SSOConfig> => {
  return {
    next(iteration, key, data) {
      console.log('app', key, data);
      // ä¸æ‰§è¡Œ iteration å‡½æ•°æ•°æ®å°†ä¸ä¼šæ”¹å˜
      iteration();
    },
  };
});
```

## æ‰¹é‡æ›´æ–°

> å½“ä½¿ç”¨ React < 18 æ—¶ä½¿ç”¨æ‰¹é‡æ›´æ–°ã€‚

```js
sso.config({
  next: ReactDOM.unstable_batchedUpdates,
});
```
